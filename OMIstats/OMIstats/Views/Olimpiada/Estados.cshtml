@model OMIstats.Models.Olimpiada

@section AddToHead
{
    <link rel="stylesheet" href="~/Content/formas.css" type="text/css" />
    <link rel="stylesheet" href="~/Content/profile.css" type="text/css" />
    <link rel="stylesheet" href="~/Content/tablas.css" type="text/css" />
    <link rel="stylesheet" href="~/Content/olimpiadas.css" type="text/css"/>
}

@section scripts
{
    <script type="text/javascript" src="/Scripts/jquery.tablesorter.js"></script>
    <script type="text/javascript" src="/Scripts/jquery.metadata.js"></script>
    <script type="text/javascript" src="/js/sorters.js"></script>
    <script>
        $(function () {
            cargaSorter("tablaPuntos");
        });
    </script>
}

@{
    ViewBag.Title = "Tabla de estados de la " + Model.numero + "ª OMI";
}

<div class="submenu">
    @Html.ActionLink("Datos", "Index", "Olimpiada",
            new { clave = Model.numero }, new { @class = "mini-boton" })
    @Html.ActionLink("Resultados", "Resultados", "Olimpiada",
            new { clave = Model.numero }, new { @class = "mini-boton" })

    <br />
    <br />
    <br />
    <div class="comboTitle">Olimpiadas:</div>
    <select onChange="redirige('/Olimpiada/Estados?clave=', this.options[this.selectedIndex].value)" class="comboMargin">
        @for(int i = ViewBag.olimpiadas.Count - 1; i >= 0; i--)
        {
            OMIstats.Models.Olimpiada omi = ViewBag.olimpiadas[i];
            if (omi.numero == Model.numero)
            {
                <option value="@omi.numero" selected="selected">@(omi.numero + "ª OMI " + omi.año)</option>
            }
            else
            {
                <option value="@omi.numero">@(omi.numero + "ª OMI " + omi.año)</option>
            }
        }
    </select>
</div>

@if (ViewBag.estados.Count == 0)
{
    <h1 class="subtitulo"> No se tienen resultados para esta olimpiada </h1>
}
else
{

<h1 class="titulo">@ViewBag.Title</h1>

<table class="table" id="tablaPuntos">
    <thead>
        <tr class="table-header">
            <th class="bottom-border right-border table-header-clickable">Lugar</th>
            <th class="bottom-border right-border table-header-clickable">Estado</th>
            <th class="bottom-border right-border table-header-clickable">Oros&nbsp;&nbsp;&nbsp;</th>
            <th class="bottom-border right-border table-header-clickable">Platas&nbsp;</th>
            <th class="bottom-border right-border table-header-clickable">Bronces</th>
            <th class="bottom-border right-border table-header-clickable">Total&nbsp;&nbsp;</th>
            <th class="bottom-border table-header-clickable">Puntos</th>
        </tr>
    </thead>

    @{
    int lugar = 0;
    int count = 0;
    int totalOros = 0;
    int totalPlatas = 0;
    int totalBronces = 0;
    int totalMedallas = 0;
    float? totalPuntos = 0;
    float? lastPuntos = 0;
    }
    @foreach (OMIstats.Models.Medallero m in ViewBag.estados)
    {
        count++;
        if (lastPuntos != m.otros)
        {
            lugar = count;
        }
        lastPuntos = m.otros;
        
        totalOros += m.oros;
        totalPlatas += m.platas;
        totalBronces += m.bronces;
        totalMedallas += m.oros + m.platas + m.bronces;
        
        totalPuntos += m.otros;
        
        OMIstats.Models.Estado estado = OMIstats.Models.Estado.obtenerEstadoConClave(m.clave);
        
        <tr>
            <td class="table-td center right-border ">@lugar</td>
            <td class="table-td right-border ">
                <a class="nombre" href="@Url.Content("/Olimpiada/Delegacion?clave=" + Model.numero + "&estado=" + estado.clave)">
                    @estado.nombre
                </a>
                @if (estado.clave == Model.claveEstado)
                {
                    <sup><a class="nombre" href="#sede">1</a></sup>
                }
                @if (Model.numero.Equals("12") && Model.tipoOlimpiada == OMIstats.Models.Olimpiada.TipoOlimpiada.OMI && estado.clave == "GTO")
                {
                    <sup><a class="nombre" href="#german">2</a></sup>
                }
            </td>
            <td class="table-td center right-border fondoOro">@m.oros</td>
            <td class="table-td center right-border fondoPlata">@m.platas</td>
            <td class="table-td center right-border fondoBronce">@m.bronces</td>
            <td class="table-td center right-border ">@(m.oros + m.platas + m.bronces)</td>
            <td class="table-td center">@m.otros</td>
        </tr>
    }

    <tfoot>
        <tr>
            <td class="right-border top-border derecha pie pieTitulo table-footer" colspan="2">
                Total:
            </td>
            <td class="center right-border resultado-dia top-border pie fondoOro">
                @totalOros
            </td>
            <td class="center right-border resultado-dia top-border pie fondoPlata">
                @totalPlatas
            </td>
            <td class="center right-border resultado-dia top-border pie fondoBronce">
                @totalBronces
            </td>
            <td class="center right-border resultado-dia top-border pie table-td">
                @totalMedallas
            </td>
            <td class="center resultado-dia top-border pie table-td">
                @totalPuntos
            </td>
        </tr>
    </tfoot>
</table>

<div id="sede" class="sede">
    [1]: Al estado sede solo se le cuentan sus mejores cuatro
    competidores para esta tabla, para ver los detalles del
    resto de la delegación, visite la <a href="@Url.Content("/Olimpiada/Delegacion?clave=" + Model.numero + "&estado=" + Model.claveEstado)">página de la delegación</a>.
</div>

if (Model.numero.Equals("12") && Model.tipoOlimpiada == OMIstats.Models.Olimpiada.TipoOlimpiada.OMI)
{
    <div id="german" class="sede">
        [2]: En la 12a OMI, se le otorgó una quinta medalla
        al estado de Guanajuato por ser el primer chico de escuelas
        primaria en quedar en el medallero. Esa fue la última vez que
        se le permitió a un estado no sede ganar más de cuatro medallas.
        Al igual que con los estados sede, solo los mejores cuatro competidores
        se toman en cuenta, para más detalle, consulte la delegación
        del estado de <a href="/Olimpiada/Delegacion?clave=12&estado=GTO">Guanajuato</a>.
    </div>
}
}