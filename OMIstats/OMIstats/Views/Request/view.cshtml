@model List<OMIstats.Models.Peticion>
@using OMIstats.Models

@{
    ViewBag.Title = "Mis peticiones";
}

@section AddToHead
{
    <link href="~/Content/request.css" type="text/css" rel="stylesheet" />
    <link href="~/Content/formas.css" type="text/css" rel="stylesheet" />
}

@section Scripts
{
    <script>
            var quedan = "@Model.Count";
    </script>
    <script src="~/js/general.js"></script>
    <script src="~/js/formas.js"></script>
    <script src="~/js/request.js"></script>
}

<h2 class="titulo">Mis peticiones</h2>

<div>Aqui puedes ver las peticiones que has hecho y que necesitan ser aprobadas por un administrador. Puedes eliminarlas si así lo deseas</div>

@{
    int cambioNombre = -1;
    int cambioFoto = -1;
    int i = 0;
}

@foreach (var item in Model)
{
    if (item.tipo == Peticion.TipoPeticion.USUARIO && item.subtipo == Peticion.TipoPeticion.NOMBRE && cambioNombre == -1)
    {
        cambioNombre = i;
    }
    if (item.tipo == Peticion.TipoPeticion.USUARIO && item.subtipo == Peticion.TipoPeticion.FOTO && cambioFoto == -1)
    {
        cambioFoto = i;
    }
    i++;
}


@if (cambioNombre == -1 && cambioFoto == -1)
{
    <div class="clean">No tienes ninguna petición</div>
}
else
{
    if (cambioNombre != -1)
    {
        
    <h3>Cambio de nombre</h3>

    <table>

        <tr>
            <th>Nombre actual</th>
            <th>Nuevo nombre</th>
            <th></th>
        </tr>

        @for (int j = cambioNombre; j < Model.Count; j++)
        {
            <tr id='@Url.Content("row" + @Model[j].clave)'>
                @if (Model[j].tipo == Peticion.TipoPeticion.USUARIO && Model[j].subtipo == Peticion.TipoPeticion.NOMBRE)
                {
                    <td class="tdNombre">
                       @ViewBag.usuario.nombre
                    </td>
                    <td class="tdNombre">
                       @Html.DisplayFor(model => Model[j].datos1)
                    </td>
                    <td>
                       <a href="javascript:eliminar(@Model[j].clave)">Eliminar</a>
                       <div id='@Url.Content("error" + @Model[j].clave)' class="textoRojo">
                        Hubo un error. Inténtalo más tarde.
                       </div>
                    </td>
                }
                else
                {
                    break;
                }
            </tr>
        }

    </table>
    }
    
    if (cambioFoto != -1)
    {
        
    <h3>Cambio de foto</h3>

    <table>

        <tr>
            <th>Foto actual</th>
            <th>Nueva foto</th>
            <th></th>
        </tr>

        @for (int j = cambioFoto; j < Model.Count; j++)
        {
            <tr id='@Url.Content("row" + @Model[j].clave)'>
                @if (Model[j].tipo == Peticion.TipoPeticion.USUARIO && Model[j].subtipo == Peticion.TipoPeticion.FOTO)
                {
                    <td class="tdFoto">
                       <img src='@Url.Content(ViewBag.usuario.foto)' alt="foto"/>
                    </td>
                    <td class="tdFoto">
                       <img src='@Url.Content(Path.Combine("/img/temp", Model[j].datos1))' alt="foto"/>
                    </td>
                    <td>
                       <a href="javascript:eliminar(@Model[j].clave)">Eliminar</a>
                       <div id='@Url.Content("error" + @Model[j].clave)' class="textoRojo">
                        Hubo un error. Inténtalo más tarde.
                       </div>
                    </td>
                }
                else
                {
                    break;
                }
            </tr>
        }

    </table>
    }
}

<!-- -TODO- Agregar algun lugar que apunte aqui -->