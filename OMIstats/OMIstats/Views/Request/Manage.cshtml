@model List<OMIstats.Models.Peticion>
@using OMIstats.Models

@{
    ViewBag.Title = "Administrar peticiones";
}

@section AddToHead
{
    <link href="~/Content/request.css" type="text/css" rel="stylesheet" />
    <link href="~/Content/formas.css" type="text/css" rel="stylesheet" />
}

@section Scripts
{
    <script>
        var quedan = "@Model.Count";
        var total = "@ViewBag.totalPeticiones";
    </script>
    <script src="~/js/general.js"></script>
    <script src="~/js/formas.js"></script>
    <script src="~/js/request.js"></script>
    <script src="~/js/admin.js"></script>
}

<h2 class="titulo">Lista de peticiones</h2>

@if (Model.Count == 0)
{
    <div class="clean">No queda ninguna petición</div>
}
else
{
    int counter = 0;

<table border="1">
    <thead>
        <tr>
            <th>
                Acciones
            </th>
            <th>
                Tipo de petición
            </th>
            <th>
                Usuario
            </th>
            <th>
                Petición
            </th>
        </tr>
    </thead>
    <tfoot>
        <tr>
            <td colspan="4">
                <span>En esta página: <span id="quedan" class="negritas"> @Model.Count </span>  </span>
                <span class="right">Total: <span id="total" class="negritas"> @ViewBag.totalPeticiones </span></span>
            </td>
        </tr>
    </tfoot>
    @foreach (var item in Model)
    {
        string clase;
        if (counter % 2 == 0)
        {
            clase = "par";
        }
        else
        {
            clase = "impar";
        }
        counter++;
        <tr id='@Url.Content("row" + @item.clave)' class="@clase">
            <td>
                @if (item.tipo == Peticion.TipoPeticion.GENERAL)
                {
                    <div class="biginput">
                        <textarea cols="20" id="@Url.Content("correoRespuesta" + @item.clave)" rows="2"></textarea>
                    </div>
                    <a href="javascript:aprobar(@item.clave)">Responder</a>
                }
                else
                {
                    <a href="javascript:aprobar(@item.clave)">Aprobar</a>
                }
                <a class="errorTextoRojo" href="javascript:eliminar(@item.clave)">Eliminar</a>
                <br />
                <div id='@Url.Content("error" + @item.clave)' class="textoRojo">
                    Hubo un error, recarga la página e intenta de nuevo.
                </div>
                <img class="textoRojo" id='@Url.Content("loading" + @item.clave)' src="~/img/ajax-loader.gif" />
            </td>

            @if (item.tipo == Peticion.TipoPeticion.USUARIO)
            {
                if (item.subtipo == Peticion.TipoPeticion.NOMBRE)
                {
                    <td class="negritas">
                        Cambio de nombre
                    </td>
                    <td>
                        @Html.ActionLink(item.usuario.nombre, "view", "Profile",
                        new { usuario = @item.usuario.usuario }, new { @class = "nombre", target="_blank" })
                    </td>
                    <td>
                        <span class="negritas">Nuevo nombre:</span>
                        @Html.DisplayFor(modelItem => item.datos1)
                    </td>
                }

                if (item.subtipo == Peticion.TipoPeticion.FOTO)
                {
                    <td class="negritas">
                        Cambio de foto
                    </td>
                    <td>
                        @Html.ActionLink(item.usuario.nombre, "view", "Profile",
                        new { usuario = @item.usuario.usuario }, new { @class = "nombre", target="_blank" })
                    </td>
                    <td>
                        <a href='@Url.Content("/img/temp/" + @item.datos1)' target="_blank" class="negritas">Nueva foto</a>
                    </td>
                }

                if (item.subtipo == Peticion.TipoPeticion.ACCESO)
                {
                    <td class="negritas">
                        Acceso
                    </td>
                    <td>
                        @Html.ActionLink(item.usuario.nombre, "view", "Profile",
                        new { usuario = @item.usuario.usuario }, new { @class = "nombre", target="_blank" })
                    </td>
                    <td>
                        @if (!Char.IsDigit(@item.usuario.usuario[0]))
                        {
                            <span class="negritas errorTextoRojo">Precaución:</span>
                            <span>Usuario ya ha sido reclamado</span>
                            <br />
                        }
                        @if (!String.IsNullOrEmpty(@item.datos1))
                        {
                            <a href='@Url.Content("/img/temp/" + @item.datos1)' target="_blank" class="negritas">Diploma</a>
                            <br />
                        }
                        <span class="negritas">Correo:</span>
                        @Html.DisplayFor(modelItem => item.datos2)
                        <br />
                        @if (!String.IsNullOrEmpty(@item.datos3))
                        {
                            <span class="negritas">Información:</span>
                            @Html.DisplayFor(modelItem => item.datos3)
                        }
                    </td>
                }
            }
            else if (item.tipo == Peticion.TipoPeticion.GENERAL)
            {
                <td class="negritas">
                    @item.subtipo
                </td>
                <td>
                    @item.datos1
                </td>
                <td>
                    @item.datos3
                </td>
            }

        </tr>
    }
</table>

}